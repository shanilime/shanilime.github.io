<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ShaniSnake — shanilime.github.io</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1724; --accent:#00d1ff; --accent2:#7cff8f; --muted:#9aa4b2; --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family:Inter,Segoe UI,Roboto,Arial,sans-serif; background:linear-gradient(180deg,var(--bg),#071226);
      color:#e6eef8; display:flex; align-items:center; justify-content:center; padding:24px;
    }

    .wrap{width:100%; max-width:980px; display:grid; grid-template-columns:1fr 320px; gap:24px; align-items:start}

    header{grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px}
    h1{font-size:20px; margin:0}
    .who{font-size:13px; color:var(--muted)}

    .game-card{background:linear-gradient(180deg,var(--panel),#0c1724); padding:18px; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.6);}
    .side-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01)); padding:18px; border-radius:12px;}

    canvas{display:block; background:linear-gradient(180deg,#051022 40%, #071227); width:100%; height:auto; border-radius:8px; box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}

    .hud{display:flex; gap:10px; margin-top:10px; align-items:center}
    .badge{background:var(--glass); padding:8px 12px; border-radius:999px; font-weight:600; color:var(--accent)}
    .muted{color:var(--muted); font-size:13px}

    .controls{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
    .btn{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:8px 10px; border-radius:8px; cursor:pointer; color:inherit}
    .btn.primary{background:var(--accent); color:#041226; border:none}

    .stats{display:flex; flex-direction:column; gap:8px}
    .stat{display:flex; justify-content:space-between; align-items:center; padding:8px; background:rgba(255,255,255,0.02); border-radius:8px}

    .mobile-controls{display:none; margin-top:12px; gap:8px}
    .dp{display:grid; grid-template-columns:repeat(3,64px); gap:8px; justify-content:center}
    .dp button{width:64px; height:64px; border-radius:8px}

    .footer{grid-column:1/-1; margin-top:6px; color:var(--muted); font-size:13px; text-align:right}

    /* responsive */
    @media (max-width:900px){
      .wrap{grid-template-columns:1fr;}
      .who{display:block}
      .mobile-controls{display:block}
      .side-card{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ShaniSnake</h1>
        <div class="who">shanilime.github.io</div>
      </div>
      <div class="who">Управление: стрелки или WASD · Коснитесь экранных кнопок на телефоне</div>
    </header>

    <div class="game-card">
      <canvas id="game" width="640" height="640"></canvas>
      <div class="hud">
        <div class="badge">Очки: <span id="score">0</span></div>
        <div class="muted">Скорость: <span id="speedLabel">6</span></div>
        <div style="flex:1"></div>
        <button class="btn" id="pauseBtn">Пауза</button>
        <button class="btn primary" id="restartBtn">Новая игра</button>
      </div>

      <div class="mobile-controls">
        <div class="dp">
          <div></div>
          <button class="btn" data-dir="up">▲</button>
          <div></div>
          <button class="btn" data-dir="left">◀</button>
          <button class="btn" data-dir="down">▼</button>
          <button class="btn" data-dir="right">▶</button>
        </div>
      </div>
    </div>

    <aside class="side-card">
      <div class="stats">
        <div class="stat"><div>Лучший счёт</div><div id="best">0</div></div>
        <div class="stat"><div>Длина змейки</div><div id="len">1</div></div>
        <div class="stat"><div>Уровень</div><div id="level">1</div></div>
      </div>

      <div style="margin-top:12px">
        <label class="muted">Скорость (1-20)</label>
        <input id="speed" type="range" min="2" max="18" value="6" style="width:100%">
      </div>
    </aside>

    <div class="footer">Сделано с ❤️ — shanilime.github.io · Сгенерировано с помощью ИИ</div>
  </div>

  <script>
    // --- Игра "Змейка" ---
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let SCALE = 32; // размер клетки в пикселях
    let cols = Math.floor(canvas.width / SCALE);
    let rows = Math.floor(canvas.height / SCALE);

    // элементы HUD
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const lenEl = document.getElementById('len');
    const levelEl = document.getElementById('level');
    const speedInput = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');

    // кнопки
    const pauseBtn = document.getElementById('pauseBtn');
    const restartBtn = document.getElementById('restartBtn');

    // state
    let snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
    let dir = {x:1,y:0};
    let nextDir = {...dir};
    let food = null;
    let score = 0;
    let best = parseInt(localStorage.getItem('snake_best')||'0');
    let speed = parseInt(speedInput.value,10) || 6; // шагов в секунду
    let paused = false;
    let gameOver = false;
    let level = 1;

    bestEl.textContent = best;
    speedLabel.textContent = speed;

    function spawnFood(){
      let tries = 0;
      while(tries++ < 1000){
        const f = {x: rand(0,cols-1), y: rand(0,rows-1)};
        if(!snake.some(s=>s.x===f.x && s.y===f.y)) { food = f; break; }
      }
    }

    function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a }

    function step(){
      if(paused || gameOver) return;
      dir = nextDir;
      const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

      // столкновение со стеной
      if(head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows){
        endGame(); return;
      }

      // столкновение с собой
      if(snake.some(s=>s.x===head.x && s.y===head.y)){
        endGame(); return;
      }

      snake.unshift(head);

      // если съели еду
      if(food && head.x === food.x && head.y === food.y){
        score += 10;
        if(score > best){ best = score; localStorage.setItem('snake_best', String(best)); bestEl.textContent = best; }
        spawnFood();
        // уровень увеличивается каждые 50 очков
        level = Math.floor(score/50)+1;
      } else {
        snake.pop();
      }

      // апдейт HUD
      scoreEl.textContent = score;
      lenEl.textContent = snake.length;
      levelEl.textContent = level;
    }

    function endGame(){
      gameOver = true;
      paused = true;
      pauseBtn.textContent = 'Пауза';
      setTimeout(()=>{
        if(confirm('Игра окончена. Ваш счёт: '+score+'\nЗапустить новую игру?')){
          restart();
        }
      },50);
    }

    function restart(){
      snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
      dir = {x:1,y:0}; nextDir = {...dir};
      score = 0; level = 1; gameOver = false; paused = false;
      spawnFood();
      scoreEl.textContent = score; lenEl.textContent = snake.length; levelEl.textContent = level;
    }

    // рендеринг
    function render(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // еда
      if(food){
        drawCell(food.x,food.y, '#ff6b6b');
        ctx.fillStyle = 'rgba(255,255,255,0.12)';
        ctx.fillRect(food.x*SCALE+SCALE*0.15, food.y*SCALE+SCALE*0.15, SCALE*0.7, SCALE*0.7);
      }

      // змейка
      if(snake.length){
        drawCell(snake[0].x, snake[0].y, 'linear-gradient');
        for(let i=1;i<snake.length;i++){
          const s = snake[i];
          const t = i/snake.length;
          const g = mixColor('#00d1ff','#7cff8f', t);
          drawCell(s.x,s.y,g);
        }
      }

      ctx.strokeStyle = 'rgba(255,255,255,0.03)';
      ctx.strokeRect(0,0,canvas.width,canvas.height);
    }

    function drawCell(x,y,color){
      const px = x*SCALE, py = y*SCALE;
      if(color==='linear-gradient'){
        const g = ctx.createLinearGradient(px,py,px+SCALE,py+SCALE);
        g.addColorStop(0,'#7cff8f'); g.addColorStop(1,'#00d1ff');
        ctx.fillStyle = g;
      } else ctx.fillStyle = color;
      roundRect(ctx, px+2, py+2, SCALE-4, SCALE-4, 6, true, false);
    }

    function roundRect(ctx, x, y, w, h, r, fill, stroke){
      if (typeof r === 'undefined') r = 5;
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + w, y, x + w, y + h, r);
      ctx.arcTo(x + w, y + h, x, y + h, r);
      ctx.arcTo(x, y + h, x, y, r);
      ctx.arcTo(x, y, x + w, y, r);
      ctx.closePath();
      if (fill) ctx.fill();
      if (stroke) ctx.stroke();
    }

    function mixColor(a,b,t){
      const pa = hexToRgb(a), pb = hexToRgb(b);
      const r = Math.round(pa.r*(1-t)+pb.r*t);
      const g = Math.round(pa.g*(1-t)+pb.g*t);
      const bl = Math.round(pa.b*(1-t)+pb.b*t);
      return `rgb(${r},${g},${bl})`;
    }
    function hexToRgb(hex){
      hex = hex.replace('#','');
      return {r: parseInt(hex.substr(0,2),16), g: parseInt(hex.substr(2,2),16), b: parseInt(hex.substr(4,2),16)};
    }

    // таймер
    let lastTime = 0; let accumulator = 0;
    function loop(ts){
      if(!lastTime) lastTime = ts;
      const dt = (ts - lastTime)/1000; lastTime = ts;
      const effectiveSpeed = speed * (1 + (level-1)*0.06);
      const stepInterval = 1 / effectiveSpeed;
      accumulator += dt;
      while(accumulator >= stepInterval){ step(); accumulator -= stepInterval; }
      render();
      requestAnimationFrame(loop);
    }

    // ввод
    // ввод (фикс: поддержка любых раскладок — используем event.code)
    window.addEventListener('keydown', e=>{
      const code = e.code; // физическая клавиша (KeyW, ArrowUp и т.д.)
      const key = (e.key || '').toLowerCase(); // запасной вариант
      let handled = false;

      // стрелки
      if(code === 'ArrowUp' || code === 'ArrowDown' || code === 'ArrowLeft' || code === 'ArrowRight') {
        if(code === 'ArrowUp') setDir(0,-1);
        else if(code === 'ArrowDown') setDir(0,1);
        else if(code === 'ArrowLeft') setDir(-1,0);
        else if(code === 'ArrowRight') setDir(1,0);
        handled = true;
      }

      // WASD по физическим клавишам (работает на любой раскладке) и Numpad 8/4/6/2
      else if(code === 'KeyW' || code === 'Numpad8') { setDir(0,-1); handled = true; }
      else if(code === 'KeyS' || code === 'Numpad2') { setDir(0,1); handled = true; }
      else if(code === 'KeyA' || code === 'Numpad4') { setDir(-1,0); handled = true; }
      else if(code === 'KeyD' || code === 'Numpad6') { setDir(1,0); handled = true; }

      // запасной вариант: если по какой-то причине code недоступен — проверим key (буквы/строки)
      else if(key === 'arrowup' || key === 'arrowdown' || key === 'arrowleft' || key === 'arrowright'){
        if(key === 'arrowup') setDir(0,-1);
        else if(key === 'arrowdown') setDir(0,1);
        else if(key === 'arrowleft') setDir(-1,0);
        else if(key === 'arrowright') setDir(1,0);
        handled = true;
      } else if(key === 'w' || key === 'ц') { setDir(0,-1); handled = true; } // русская W -> 'ц'
      else if(key === 's' || key === 'ы') { setDir(0,1); handled = true; }
      else if(key === 'a' || key === 'ф') { setDir(-1,0); handled = true; }
      else if(key === 'd' || key === 'в') { setDir(1,0); handled = true; }

      // пауза (Space)
      else if(code === 'Space' || key === ' ') { togglePause(); handled = true; }

      if(handled) e.preventDefault();
    });

    function setDir(x,y){
      if(x === -dir.x && y === -dir.y) return;
      nextDir = {x,y};
    }

    document.querySelectorAll('.dp button').forEach(b=>{
      b.addEventListener('click', ()=>{
        const d = b.dataset.dir;
        if(d==='up') setDir(0,-1);
        if(d==='down') setDir(0,1);
        if(d==='left') setDir(-1,0);
        if(d==='right') setDir(1,0);
      });
    });

    function togglePause(){ paused = !paused; pauseBtn.textContent = paused ? '▶' : 'Пауза'; }
    pauseBtn.addEventListener('click', ()=>{ togglePause(); });
    restartBtn.addEventListener('click', ()=>{ restart(); });

    speedInput.addEventListener('input', ()=>{ speed = parseInt(speedInput.value,10); speedLabel.textContent = speed; });

    function recalc(){
      const parentWidth = canvas.parentElement.clientWidth;
      const size = Math.floor(Math.min(parentWidth, 640));
      canvas.style.width = size + 'px';
    }
    window.addEventListener('resize', recalc);

    spawnFood();
    recalc();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
